实验步骤记录

1. 打开工程

2. 添加IP核

   应该是已经添加完毕了吧？

3. 连接数码管、sw、led到8255

   （1） 数码管

   ​	显示倒计时的值

   ​	PC0, PC1连接数码管A0, A1选择显示的位

   ​	PB0-6作为输出口连接数码管段码

   ​	同样，数码管只接受输出而不输入，接在out信号线上

   ```verilog
   assign an = {6'b000000, pcout[1:0]};
   assign segs = {2'b00, pbout[6:0]};
   ```

   ##### （2） sw

   ##### 	暂时没明白哪里用到这个了

   （3） LED

   ​	RD1,YD1,GD1与PA7,PB6,PA5相连，

   ​	RD0, YD0, GD0与PA2, PA1, PA0相连（方式0）

   ​	方式0中各口初始化后单向传送。LED只从8255读取输出而不输入，因此全部接在out信号线上

   ```verilog
   //LED灯与8255引脚相连自行决定，但所编程序要与之对应
   assign led_[1]	  = paout[5];
   assign led_[9]	  = pbout[6];
   assign led_[17]	  = paout[7];   
   assign led_[0]	  = paout[0];
   assign led_[8]	  = paout[1];
   assign led_[16]	  = paout[2];
   ```

   4. 地址译码器端口连接

   ```verilog
   Decoder U1(
   .A(adr[4]),
   .B(adr[5]),
   .C(adr[6]),
   .G1(1),                                                
   .G2AN( ior_n & iow_n ),     
   .G2BN(adr[7]|adr[8]|adr[9]),
   .Y4N(s8254csn),
   .Y5N(piccsn),
   .Y6N(s8255csn)
   );
   ```

   (5) 完成模块连接 [ ? ]

   在8254中，我们需要产生的是方波信号。

   (6) 应答信号发生器修改(PIC)

   PIC用来控制中断。8254产生的中断信号实际上是out由低到高的跳变。此处应该单独使用

   (7) 输入多路选择器修改(multidax)

   (8) 汇编程序

   (9) 生成coe



===================================================

或者另外一个思路是干脆用方式2的方式，产生中断信号，根本不用“包装流水线”例题的方法？

我们用2-2作为频率发生器？我们要的是1Hz脉冲，现在是10MHz

因此2个级联，1000000=2000*5000， cnt1使用方法2，和cnt2使用方法3

然后装入3，使用方法2

（嘤嘤嘤好复杂）

第一个初值5000，第二个初值2000，第三个初值

===================================================

分析：

绿灯1，红灯2同时亮10s （8254 10s倒计时）

黄灯1闪烁2次，闪烁周期2s，同时红灯2继续亮（8254 4s倒计时）

红灯1、绿灯2同时亮10s （8254 10s倒计时）

红灯亮，黄灯闪烁2s （8254 4s倒计时）

转1重复

数码管一直显示倒计时的值

将8254 的计数通道1用于10s计数；计数通道2用于4s计数，当计数通道1的OUT出现0-1跳变时，启动技术通道2开始定时，通道2定时阶段将1停止技术，故gate1连接out，即控制停止的信号；gate2连接out1，。使用方式2计数

计数器0负责时钟转换；计数器1负责倒计时10s，计数器2负责倒计时4s

即f1 = 0.1 Hz, f2 = 1/4 = 0.25 Hz

两个计数器级联最大技术范围$65536\times 65536=4.29 \times 10^9$ 

$$out1 = 10000000/0.1 = 10^7$$

$$out2 = 10000000/0.25 = 4*10^6$$

都在计数范围内 。 

10^7 = 10^4*1000 = 2710H, 03E8H

4*10^6 = 10^4 * 400 = 2710, 0190H

=====================================================

更好的方法：

在中断的1s内重新写入数据。这样就只需要两个cnt，均采用方式2。cnt0写入2710H，cnt1中写入03e8或者0190，由中断程序判定。期间循环读出内容并送给数码管

