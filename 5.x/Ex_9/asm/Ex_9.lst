Microsoft (R) Macro Assembler Version 6.11		    12/11/18 17:58:43
Ex_9.asm						     Page 1 - 1


 0000				DATA SEGMENT 'DATA'
 0000 0A			    COUNT DB 10
 0001 01			    STATE DB 1
 0002				DATA ENDS

 0000				CODE SEGMENT 'CODE'
				    ASSUME DS:DATA, CS:CODE
 0000				START:
				    ; INIT DS
 0000  B8 0080			    MOV AX, 80H
 0003  8E D8			    MOV DS, AX
 0005  C6 06 0000 R 0A		    MOV BYTE PTR COUNT, 10
 000A  C6 06 0001 R 03		    MOV BYTE PTR STATE, 3
				    ; INIT 8254
 000F  B0 36			    MOV AL, 00110110B   ; T/C0 WMODE = 3
 0011  E6 46			    OUT 46H, AL
 0013  B8 2710			    MOV AX, 10000   ; 10MHZ -> 1000HZ
 0016  E6 40			    OUT 40H, AL
 0018  8A C4			    MOV AL, AH
 001A  E6 40			    OUT 40H, AL
 001C  B0 76			    MOV AL, 01110110B   ; T/C1
 001E  E6 46			    OUT 46H, AL
 0020  B8 03E8			    MOV AX, 1000    ; 1000HZ->1HZ
 0023  E6 42			    OUT 42H, AL
 0025  8A C4			    MOV AL, AH
 0027  E6 42			    OUT 42H, AL
				    ; INIT 8255
 0029  B0 10			    MOV AL, 10H ; A组方式0输出
 002B  E6 66			    OUT 66H, AL
				    ; INIT 8259
				    ; ICW1 边沿触发 单片 不需要ICW4
 002D  B0 10			    MOV AL, 00010000B   
 002F  E6 50			    OUT 50H, AL
				    ; ICW2
 0031  B0 10			    MOV AL, 00010000B   ; ICW2 = 10H
 0033  E6 52			    OUT 52H, AL
				    ; MODIFY IVT
 0035  FA			    CLI ; CLOSE INT
 0036  B8 0000			    MOV AX, 0   ; IVT 0000H~03FFH
 0039  8E C0			    MOV ES, AX
 003B  BE 0040			    MOV SI, 40H ; 中断向量号10H
 003E  B8 0051 R		    MOV AX, OFFSET SERVICE
 0041  26: 89 04		    MOV ES:[SI], AX
 0044  8C C8			    MOV AX, CS
 0046  26: 89 44 02		    MOV ES:[SI+2], AX

 004A  B0 01			    MOV AL, 01H
 004C  E6 64			    OUT 64H, AL
 004E  FB			    STI
 004F  EB FE			    JMP $
 0051				SERVICE PROC FAR
 0051  1E			    PUSH DS
 0052  FB			    STI

 0053  80 3E 0001 R 01		    CMP STATE, 1
 0058  74 15			    JZ S1
 005A  80 3E 0001 R 02		    CMP STATE, 2
 005F  74 30			    JZ S2
 0061  80 3E 0001 R 03		    CMP STATE, 3
 0066  74 55			    JZ S3
 0068  80 3E 0001 R 04		    CMP STATE, 4
 006D  74 6D			    JZ S4
 006F				S1:
				    ; GD1 (PA5), RD0 (PA2)
 006F  B0 24			    MOV AL, 00100100B
 0071  E6 60			    OUT 60H, AL
 0073  FE 0E 0000 R		    DEC COUNT
 0077  A0 0000 R		    MOV AL, COUNT
 007A  E6 62			    OUT 62H, AL
 007C  80 3E 0000 R 00		    CMP COUNT, 0
 0081  74 03 E9 0083		    JNZ DONE

 0086  C6 06 0000 R 04		    MOV COUNT, 4
 008B  FE 06 0001 R		    INC STATE
 008F  EB 78			    JMP DONE
 0091				S2:
				    ; YD1 (PA6), RD0 (PA2)
 0091  F6 06 0000 R 01		    TEST COUNT, 1   ; 偶数则YD1亮
 0096  74 06			    JZ S2A
				    ; YD1灭
 0098  B0 04			    MOV AL, 00000100B
 009A  E6 60			    OUT 60H, AL
 009C  EB 04			    JMP S2B ; YD1 
 009E				S2A:
 009E  B0 24			    MOV AL, 00100100B
 00A0  E6 60			    OUT 60H, AL
 00A2				S2B:
 00A2  FE 0E 0000 R		    DEC COUNT
 00A6  A0 0000 R		    MOV AL, COUNT
 00A9  E6 62			    OUT 62H, AL
 00AB  80 3E 0000 R 00		    CMP COUNT, 0
 00B0  75 57			    JNZ DONE

 00B2  C6 06 0000 R 0A		    MOV COUNT, 10
 00B7  FE 06 0001 R		    INC STATE
 00BB  EB 4C			    JMP DONE
 00BD				S3:
				    ; GD0 (PA0), RD1(PA7)
 00BD  B0 81			    MOV AL, 10000001B
 00BF  E6 60			    OUT 60H, AL
 00C1  FE 0E 0000 R		    DEC COUNT
 00C5  A0 0000 R		    MOV AL, COUNT
 00C8  E6 62			    OUT 62H, AL
 00CA  80 3E 0000 R 00		    CMP COUNT, 0
 00CF  75 38			    JNZ DONE

 00D1  C6 06 0000 R 04		    MOV COUNT, 4
 00D6  FE 06 0001 R		    INC STATE
 00DA  EB 2D			    JMP DONE
 00DC				S4:
				    ; YD0 (PA1), RD1 (PA7)
 00DC  F6 06 0000 R 01		    TEST COUNT, 1   ; 偶数则YD0亮
 00E1  74 06			    JZ S4A
				    ; YD0灭
 00E3  B0 80			    MOV AL, 10000000B
 00E5  E6 60			    OUT 60H, AL
 00E7  EB 04			    JMP S4B ; YD1 
 00E9				S4A:
 00E9  B0 82			    MOV AL, 10000010B
 00EB  E6 60			    OUT 60H, AL
 00ED				S4B:
 00ED  FE 0E 0000 R		    DEC COUNT
 00F1  A0 0000 R		    MOV AL, COUNT
 00F4  E6 62			    OUT 62H, AL
 00F6  80 3E 0000 R 00		    CMP COUNT, 0
 00FB  75 0C			    JNZ DONE

 00FD  C6 06 0000 R 0A		    MOV COUNT, 10
 0102  C6 06 0001 R 01		    MOV STATE, 1
 0107  EB 00			    JMP DONE
 0109				DONE:
 0109  FA			    CLI
 010A  B0 60			    MOV AL, 01100000B
 010C  E6 50			    OUT 50H, AL ; OCW2
 010E  1F			    POP DS
 010F  CF			    IRET
 0110				SERVICE ENDP

 0110				CODE ENDS
				    END START
Microsoft (R) Macro Assembler Version 6.11		    12/11/18 17:58:43
Ex_9.asm						     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

CODE . . . . . . . . . . . . . .	16 Bit	 0110	  Para	  Private 'CODE'	
DATA . . . . . . . . . . . . . .	16 Bit	 0002	  Para	  Private 'DATA'	


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

SERVICE  . . . . . . . . . . . .	P Far	 0051	  CODE	Length= 00C7 Private


Symbols:

                N a m e                 Type     Value    Attr

COUNT  . . . . . . . . . . . . .	Byte	 0000	  DATA	
DONE . . . . . . . . . . . . . .	L Near	 0109	  CODE	
S1 . . . . . . . . . . . . . . .	L Near	 006F	  CODE	
S2A  . . . . . . . . . . . . . .	L Near	 009E	  CODE	
S2B  . . . . . . . . . . . . . .	L Near	 00A2	  CODE	
S2 . . . . . . . . . . . . . . .	L Near	 0091	  CODE	
S3 . . . . . . . . . . . . . . .	L Near	 00BD	  CODE	
S4A  . . . . . . . . . . . . . .	L Near	 00E9	  CODE	
S4B  . . . . . . . . . . . . . .	L Near	 00ED	  CODE	
S4 . . . . . . . . . . . . . . .	L Near	 00DC	  CODE	
START  . . . . . . . . . . . . .	L Near	 0000	  CODE	
STATE  . . . . . . . . . . . . .	Byte	 0001	  DATA	

	   0 Warnings
	   0 Errors
